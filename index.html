<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.10.0/dist/ffmpeg.min.js" crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="/images/logo-192.png">
    <link rel="stylesheet" href="/main.css">
    <link rel="manifest" href="/manifest.webmanifest">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans&display=swap" rel="stylesheet">
    <title>Rolla | Automatic A-Roll Editor</title>
    <script src="/app.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
        }
    </script>
</head>
<body>
<div class="wrapper">
    <div class="inner">
        <svg id="logo" viewBox="0 0 261 349" xmlns="http://www.w3.org/2000/svg">
            <rect x="94" y="151" width="144" height="48" rx="24" fill="white"/>
            <rect x="181" y="208" width="80" height="48" rx="24" fill="white"/>
            <rect x="94" y="94" width="48" height="48" rx="24" fill="white"/>
            <rect x="197" y="94" width="64" height="48" rx="24" fill="white"/>
            <path d="M29 22.6225V12C29 5.37258 34.3726 0 41 0H65H89C95.6274 0 101 5.37258 101 12V22.6225C101 26.0436 99.5398 29.302 96.9865 31.5789L84.8275 42.4211C82.2741 44.698 80.814 47.9564 80.814 51.3775V240.186C80.814 248.92 73.7338 256 65 256C56.2662 256 49.186 248.92 49.186 240.186V51.3775C49.186 47.9564 47.7259 44.698 45.1725 42.4211L33.0136 31.5789C30.4602 29.302 29 26.0436 29 22.6225Z"
                  fill="white"/>
            <rect x="94" y="37" width="156" height="48" rx="24" fill="white"/>
            <path d="M11.9 317.5C9.36667 317.5 7.56667 316.167 6.5 313.5C5.5 310.833 5 306.567 5 300.7C5 292.033 6.23333 283.8 8.7 276C9.3 274.067 10.2667 272.667 11.6 271.8C13 270.867 14.9333 270.4 17.4 270.4C18.7333 270.4 19.6667 270.567 20.2 270.9C20.7333 271.233 21 271.867 21 272.8C21 273.867 20.5 276.267 19.5 280C18.8333 282.667 18.3 285 17.9 287C17.5 289 17.1667 291.467 16.9 294.4C19.1 288.667 21.5667 284 24.3 280.4C27.0333 276.8 29.7 274.233 32.3 272.7C34.9667 271.167 37.4 270.4 39.6 270.4C43.9333 270.4 46.1 272.567 46.1 276.9C46.1 277.767 45.8 279.867 45.2 283.2C44.6667 285.867 44.4 287.533 44.4 288.2C44.4 290.533 45.2333 291.7 46.9 291.7C48.7667 291.7 51.1667 290.233 54.1 287.3C54.9667 286.433 55.8667 286 56.8 286C57.6667 286 58.3333 286.4 58.8 287.2C59.3333 287.933 59.6 288.933 59.6 290.2C59.6 292.667 58.9333 294.6 57.6 296C55.7333 297.933 53.5333 299.6 51 301C48.5333 302.333 45.9 303 43.1 303C39.5667 303 36.8667 302.1 35 300.3C33.2 298.5 32.3 296.067 32.3 293C32.3 292 32.4 291 32.6 290C32.7333 288.667 32.8 287.767 32.8 287.3C32.8 286.233 32.4333 285.7 31.7 285.7C30.7 285.7 29.3667 286.833 27.7 289.1C26.1 291.3 24.5 294.233 22.9 297.9C21.3 301.567 20 305.433 19 309.5C18.2667 312.633 17.4 314.767 16.4 315.9C15.4667 316.967 13.9667 317.5 11.9 317.5ZM100.308 286.3C101.174 286.3 101.841 286.733 102.308 287.6C102.774 288.467 103.008 289.567 103.008 290.9C103.008 294.1 102.041 296 100.108 296.6C96.1078 298 91.7078 298.8 86.9078 299C85.6411 304.6 83.1411 309.1 79.4078 312.5C75.6745 315.833 71.4411 317.5 66.7078 317.5C62.7078 317.5 59.2745 316.533 56.4078 314.6C53.6078 312.667 51.4745 310.1 50.0078 306.9C48.5411 303.7 47.8078 300.233 47.8078 296.5C47.8078 291.433 48.7745 286.933 50.7078 283C52.6411 279 55.3078 275.9 58.7078 273.7C62.1078 271.433 65.8745 270.3 70.0078 270.3C75.0745 270.3 79.1411 272.067 82.2078 275.6C85.3411 279.067 87.1745 283.367 87.7078 288.5C90.8411 288.3 94.5745 287.633 98.9078 286.5C99.4411 286.367 99.9078 286.3 100.308 286.3ZM67.5078 306.9C69.6411 306.9 71.4745 306.033 73.0078 304.3C74.6078 302.567 75.6745 300.067 76.2078 296.8C74.1411 295.4 72.5411 293.567 71.4078 291.3C70.3411 289.033 69.8078 286.633 69.8078 284.1C69.8078 283.033 69.9078 281.967 70.1078 280.9H69.6078C66.9411 280.9 64.7078 282.2 62.9078 284.8C61.1745 287.333 60.3078 290.933 60.3078 295.6C60.3078 299.267 61.0078 302.067 62.4078 304C63.8745 305.933 65.5745 306.9 67.5078 306.9ZM131.325 294.7C132.192 294.7 132.858 295.1 133.325 295.9C133.858 296.7 134.125 297.8 134.125 299.2C134.125 301.867 133.492 303.933 132.225 305.4C129.358 308.933 126.225 311.833 122.825 314.1C119.492 316.367 115.692 317.5 111.425 317.5C105.558 317.5 101.192 314.833 98.325 309.5C95.525 304.167 94.125 297.267 94.125 288.8C94.125 280.667 95.1583 271.4 97.225 261C99.3583 250.6 102.458 241.667 106.525 234.2C110.658 226.733 115.558 223 121.225 223C124.425 223 126.925 224.5 128.725 227.5C130.592 230.433 131.525 234.667 131.525 240.2C131.525 248.133 129.325 257.333 124.925 267.8C120.525 278.267 114.558 288.633 107.025 298.9C107.492 301.633 108.258 303.6 109.325 304.8C110.392 305.933 111.792 306.5 113.525 306.5C116.258 306.5 118.658 305.733 120.725 304.2C122.792 302.6 125.425 299.9 128.625 296.1C129.425 295.167 130.325 294.7 131.325 294.7ZM119.025 232.9C117.492 232.9 115.758 235.667 113.825 241.2C111.892 246.733 110.192 253.6 108.725 261.8C107.258 270 106.458 277.867 106.325 285.4C111.058 277.6 114.825 269.8 117.625 262C120.425 254.133 121.825 246.967 121.825 240.5C121.825 235.433 120.892 232.9 119.025 232.9ZM162.942 294.7C163.809 294.7 164.476 295.1 164.942 295.9C165.476 296.7 165.742 297.8 165.742 299.2C165.742 301.867 165.109 303.933 163.842 305.4C160.976 308.933 157.842 311.833 154.442 314.1C151.109 316.367 147.309 317.5 143.042 317.5C137.176 317.5 132.809 314.833 129.942 309.5C127.142 304.167 125.742 297.267 125.742 288.8C125.742 280.667 126.776 271.4 128.842 261C130.976 250.6 134.076 241.667 138.142 234.2C142.276 226.733 147.176 223 152.842 223C156.042 223 158.542 224.5 160.342 227.5C162.209 230.433 163.142 234.667 163.142 240.2C163.142 248.133 160.942 257.333 156.542 267.8C152.142 278.267 146.176 288.633 138.642 298.9C139.109 301.633 139.876 303.6 140.942 304.8C142.009 305.933 143.409 306.5 145.142 306.5C147.876 306.5 150.276 305.733 152.342 304.2C154.409 302.6 157.042 299.9 160.242 296.1C161.042 295.167 161.942 294.7 162.942 294.7ZM150.642 232.9C149.109 232.9 147.376 235.667 145.442 241.2C143.509 246.733 141.809 253.6 140.342 261.8C138.876 270 138.076 277.867 137.942 285.4C142.676 277.6 146.442 269.8 149.242 262C152.042 254.133 153.442 246.967 153.442 240.5C153.442 235.433 152.509 232.9 150.642 232.9ZM167.183 317.5C163.383 317.5 160.283 316 157.883 313C155.549 310 154.383 306.067 154.383 301.2C154.383 295.867 155.616 290.833 158.083 286.1C160.549 281.3 163.816 277.467 167.883 274.6C172.016 271.667 176.383 270.2 180.983 270.2C182.449 270.2 183.416 270.5 183.883 271.1C184.416 271.633 184.849 272.633 185.183 274.1C186.449 273.833 187.849 273.7 189.383 273.7C190.983 273.7 192.216 274.1 193.083 274.9C193.949 275.7 194.383 276.833 194.383 278.3C194.383 279.833 194.049 282.5 193.383 286.3C192.649 290.367 192.083 294.267 191.683 298C191.283 301.667 191.083 305.8 191.083 310.4C191.083 312.933 190.549 314.767 189.483 315.9C188.483 316.967 186.816 317.5 184.483 317.5C182.216 317.5 180.516 316.967 179.383 315.9C178.316 314.767 177.783 312.967 177.783 310.5L177.883 308.9C175.816 314.633 172.249 317.5 167.183 317.5ZM171.083 307.4C172.949 307.4 174.649 306.1 176.183 303.5C177.716 300.9 179.083 296.267 180.283 289.6L182.183 279.5C179.449 279.567 176.916 280.633 174.583 282.7C172.249 284.7 170.383 287.367 168.983 290.7C167.583 294.033 166.883 297.567 166.883 301.3C166.883 303.3 167.249 304.833 167.983 305.9C168.783 306.9 169.816 307.4 171.083 307.4Z"
                  fill="white"/>
        </svg>
        <h1>
            Automatic
            <br>
            A-Roll Editor
        </h1>
        <p>
            <input type="file" id="media-upload" accept="audio/*,video/*">
            <label for="media-upload" id="message">Choose a Clip</label>
        </p>
    </div>
</div>
<footer>
    <div id="footer-icons">
        <a href="https://github.com/RollaEditor/rolla">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path fill="#ffffff"
                      d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path>
            </svg>
        </a>
    </div>
</footer>
<script>

    const {createFFmpeg, fetchFile} = FFmpeg;
    const ffmpeg = createFFmpeg({log: true});

    const trim = async ({target: {files}}) => {
        const message = document.getElementById('message');
        const {name} = files[0];
        message.innerHTML = 'Loading ffmpeg-core.js';
        await ffmpeg.load();
        message.innerHTML = 'Start Extracting Silence Interval';
        ffmpeg.FS('writeFile', name, await fetchFile(files[0]));
        await ffmpeg.run('-i', name, '-af', 'silencedetect=n=-50dB:d=0.5,ametadata=mode=print:file=plswork.txt', '-f', 'null', '-');
        message.innerHTML = 'Completed Extraction';

        let data;
        try {
            data = ffmpeg.FS('readFile', 'plswork.txt');
            // const objectURL = URL.createObjectURL(new Blob([data.buffer], {type: '.txt'}));
            const objectURL = URL.createObjectURL(new Blob([data.buffer], {type: '.txt'}));
            await download(objectURL)
            message.innerHTML = 'Success';
        } catch (error) {
            message.innerHTML = 'Input File has no audio track';
        }
    }

    async function download(objectURL) {
        // Credit to Aidan
        let link
        link = document.createElement('a');
        link.href = objectURL;
        link.download = `output.txt`;
        document.body.appendChild(link);
        link.click();
        link.remove();
    }

    const elm = document.getElementById('media-upload');
    elm.addEventListener('change', trim);
</script>
</body>
</html>